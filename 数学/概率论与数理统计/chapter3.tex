\chapter{二维随机变量及其分布}

\section{二维随机变量}

\subsection{二维随机变量及其分布函数}

\begin{definition}
    设随机试验 $E$ 的样本空间为 $\varOmega$，$X$ 和 $Y$ 是定义在 $\varOmega$ 上的两个随机变量，由它们构成的向量 $(X,Y)$ 称为\textbf{二维随机变量}或\textbf{二维随机向量}.
\end{definition}

\begin{definition}
    设 $(X,Y)$ 是二维随机变量.对于任意实数 $x$ 和 $y$，记事件 $\{X \leqslant x\}$ 与 $\{Y \leqslant y\}$ 的交事件为 $\{X \leqslant x, Y \leqslant y\}$，称二元函数
    $$
    F(x, y) = P\{X \leqslant x, Y \leqslant y\}, \; (x,y) \in \mathbf{R}^2
    $$
    为\textbf{二维随机变量} $(X,Y)$ \textbf{的分布函数}，或称为随机变量 $X$ 和 $Y$ 的\textbf{联合分布函数}.
\end{definition}

如果将二维随机变量 $(X,Y)$ 看做 $xOy$ 平面上随机点的坐标，则分布函数 $F(x,y)$ 在点 $(x,y)$ 处的函数值就是随机点落在以 $(x,y)$ 为顶点且位于该点左下方的无界域内的概率，如图 \ref{fig:F(x,y)} 所示.

\begin{figure}[htbp]
    \centering

    \begin{tikzpicture}[>=Stealth, scale=0.55]
        % 坐标轴
        \draw[->] (-2, 0)--(4, 0) node[below]{$x$};
        \draw[->] (0, -2)--(0, 4) node[left]{$y$};
        % 图像
        \draw[line width=1.5pt] (-1.5, 3) -- (3, 3) node[above right]{$(x,y)$} -- (3, -1.5);
        % 填充
        \fill[pattern=north east lines] (-1.5, 3)--(3, 3)--(3, -1.5)--(-1.5, -1.5);
        % 原点标记
        \node at (0, 0) [below left, fill=white] {$O$};
    \end{tikzpicture}

    \caption{}
    \label{fig:F(x,y)}
\end{figure}

分布函数 $F(x,y)$ 具有如下性质：

\setcounter{propertyname}{0}

\begin{property}
    $0 \leqslant F(x,y) \leqslant 1$，且
    \begin{gather*}
        F(-\infty, -\infty) = \lim_{\substack{x \to -\infty \\ y \to -\infty}} F(x,y) = 0 \\
        F(+\infty, +\infty) = \lim_{\substack{x \to +\infty \\ y \to +\infty}} F(x,y) = 1
    \end{gather*}
    对于任意固定的 $x$，有 $F(x,-\infty) = \displaystyle\lim_{y \to -\infty} F(x,y) = 0$.\newline
    对于任意固定的 $y$，有 $F(-\infty,y) = \displaystyle\lim_{x \to -\infty} F(x,y) = 0$.
\end{property}

\begin{property}
    $F(x,y)$ 对于每个变量都是单调不减函数.即对于任意固定的 $y$，当 $x_1 < x_2$ 时，有 $F(x_1, y) \leqslant F(x_2, y)$；对于任意固定的 $x$，当 $y_1 < y_2$ 时，有 $F(x, y_1) \leqslant F(x, y_2)$.
\end{property}

\begin{property}
    $F(x,y)$ 关于 $x$ 右连续，关于 $y$ 右连续，即
    \begin{gather*}
        F(x^+, y) = F(x, y) \\
        F(x, y^+) = F(x, y)
    \end{gather*}
\end{property}

\begin{property}
    对于任意的 $x_1 < x_2, y_1 < y_2$，有
    $$
    P\{x_1 < X \leqslant x_2, y_1 < Y \leqslant y_2\} = F(x_2, y_2) - F(x_1, y_2) - F(x_2, y_1) + F(x_1, y_1)
    $$
\end{property}

\subsection{边缘分布}

\begin{definition}
    设二维随机变量 $(X,Y)$ 的分布函数为 $F(x,y)$，记随机变量 $X$ 的分布函数为 $F_{X}(x)$，随机变量 $Y$ 的分布函数为 $F_{Y}(y)$，分别称为二维随机变量 $(X,Y)$ 关于 $X$ 和关于 $Y$ 的\textbf{边缘分布函数}.
\end{definition}

\begin{gather*}
    F_{X}(x) = P\{X \leqslant x\} = P\{X \leqslant x, Y < +\infty\} = F(x, +\infty), \quad x \in \mathbf{R} \\
    F_{Y}(y) = P\{Y \leqslant y\} = P\{X < +\infty, Y \leqslant y\} = F(+\infty, y), \quad y \in \mathbf{R}
\end{gather*}

\subsection{随机变量的独立性}

\begin{definition}
    设二维随机变量 $(X,Y)$ 的分布函数及其关于 $X$ 和关于 $Y$ 的边缘分布函数分别为 $F(x,y), F_{X}(x), F_{Y}(y)$，如果对于任意实数 $x,y$，都有 $F(x,y)=F_{X}(x)\,F_{Y}(y)$，则称随机变量 $X$ 与 $Y$ 是\textbf{相互独立}的.
\end{definition}

\section{二维离散型随机变量}

\subsection{二维离散型随机变量及其概率分布}

\begin{definition}
    如果二维随机变量 $(X,Y)$ 所有可能取的值是有限对或可列无限对，则称 $(X,Y)$ 是\textbf{二维离散型随机变量}.
\end{definition}

设 $(X,Y)$ 所有可能取的值为 $(x_i,y_j)(i,j=1,2,\cdots)$，记事件 $\{X=x_i\}$ 与 $\{Y=y_j\}$ 的交事件为 $\{X=x_i, Y=y_j\}$.

\begin{definition}
    设 $(X,Y)$ 所有可能取的值为 $(x_i,y_j)(i,j=1,2,\cdots)$，如果
    \begin{equation} \label{equation:P(X,Y)}
        P\{X=x_i, Y=y_j\} = p_{ij}, \; i,j=1,2,\cdots
    \end{equation}
    且有
    \begin{gather*}
        p_{ij} \geqslant 0 \\
        \sum_{i=1}^\infty \sum_{j=1}^\infty p_{ij} = 1
    \end{gather*}
    则称式 \eqref{equation:P(X,Y)} 为二维离散型随机变量 $(X,Y)$ 的\textbf{概率分布}，或称为随机变量 $X$ 和随机变量 $Y$ 的\textbf{联合概率分布}或\textbf{联合分布律}.
\end{definition}

$(X,Y)$ 的概率分布可以用如下的表格表示：

\begin{table}[H]
    \centering

    \begin{tabular}{c | c c c c c}
        \hline
        \diagbox{$X$}{$Y$} & $y_1$ & $y_2$ & $\cdots$ & $y_j$ & $\cdots$ \\
        \hline
        $x_1$ & $p_{11}$ & $p_{12}$ & $\cdots$ & $p_{1j}$ & $\cdots$ \\
        $x_2$ & $p_{21}$ & $p_{22}$ & $\cdots$ & $p_{2j}$ & $\cdots$ \\
        $\vdots$ & $\vdots$ & $\vdots$ & & $\vdots$ & \\
        $x_i$ & $p_{i1}$ & $p_{i2}$ & $\cdots$ & $p_{ij}$ & $\cdots$ \\
        $\vdots$ & $\vdots$ & $\vdots$ & & $\vdots$ & \\
        \hline
    \end{tabular}
\end{table}

如果二维随机变量 $(X,Y)$ 的概率分布为 $P\{X=x_i, Y=y_j\} = p_{ij} \, (i,j=1,2,\cdots$)，则 $(X,Y)$ 的分布函数为
$$
F(X,Y) = P\{X \leqslant x, Y \leqslant y\} = \sum_{x_i \leqslant x} \sum_{y_j \leqslant y} p_{ij}
$$

\subsection{边缘概率分布}

设二维离散型随机变量 $(X,Y)$ 的概率分布为
$$
P\{X=x_i, Y=y_j\} = p_{ij}, \; i,j=1,2,\cdots
$$
则有
$$
P\{X = x_i\} = P\{X=x_i, \bigcup_{j=1}^\infty \{Y=y_j\}\} = P\{\bigcup_{j=1}^\infty \{X=x_i, Y=y_j\}\}
$$
由于事件 $\{X=x_i, Y=y_j\}(j=1,2,\cdots)$ 是互不相容的，因此
$$
P\{X = x_i\} = \sum_{j=1}^\infty P\{X = x_i, Y = y_j\} = \sum_{j=1}^\infty p_{ij}
$$
记 $\displaystyle\sum_{j=1}^\infty p_{ij} = p_{i\cdot}$，则有
$$
P\{X=x_i\}=p_{i\cdot}, \; i=1,2,\cdots
$$

同理可得
$$
P\{Y = y_j\} = \sum_{i=1}^\infty P\{X = x_i, Y = y_j\} = \sum_{i=1}^\infty p_{ij} = p_{\cdot j}, \; j=1,2,\cdots
$$

\begin{definition}
    设二维离散型随机变量 $(X,Y)$ 的概率分布为
    $$
    P\{X = x_i, Y = y_j\} = p_{ij}, \; i,j=1,2,\cdots
    $$
    随机变量 $X$ 和 $Y$ 的概率分布
    \begin{gather*}
        P\{X = x_i\} = p_{i\cdot}, \; i=1,2,\cdots\\
        P\{Y = y_j\} = p_{\cdot j}, \; j=1,2,\cdots
    \end{gather*}
    分别称为 $(X,Y)$ 关于 $X$ 和关于 $Y$ 的\textbf{边缘概率分布}或\textbf{边缘分布律}.
\end{definition}

\subsection{随机变量的独立性}

设二维离散型随机变量 $(X,Y)$ 的概率分布为
$$
P\{X = x_i, Y = y_j\} = p_{ij}, \; i,j=1,2,\cdots
$$
$(X,Y)$ 关于 $X$ 和关于 $Y$ 的边缘概率分布依次为
\begin{gather*}
    P\{X=x_i\}=p_{i\cdot}, \; i=1,2,\cdots\\
    P\{Y=y_j\}=p_{\cdot j}, \; j=1,2,\cdots
\end{gather*}
则随机变量 $X$ 和 $Y$ 相互独立的充分必要条件是：对任意的 $i,j$，都有
$$
P\{X = x_i, Y = y_j\} = P\{X=x_i\} \, P\{Y=y_j\}, \; i,j=1,2,\cdots
$$
即
$$
p_{ij} = p_{i \cdot} \, p_{\cdot j}, \; i,j=1,2,\cdots
$$

\section{二维连续型随机变量}

\subsection{二维连续型随机变量及其概率密度}

\begin{definition}
    设二维随机变量 $(X,Y)$ 的分布函数为 $F(x,y)$，如果存在非负的二元函数 $f(x,y)$，对于任意实数 $x,y$，有
    $$
    F(x,y) = \int_{-\infty}^x \int_{-\infty}^y f(u,v) \, \text{d}u \text{d}v
    $$
    则称 $(X,Y)$ 为\textbf{二维连续型随机变量}，$f(x,y)$ 称为二维连续型随机变量 $(X,Y)$ 的\textbf{概率密度}，或称为随机变量 $X$ 和 $Y$ 的\textbf{联合概率密度}.
\end{definition}

概率密度 $f(x,y)$ 具有下列性质：

\setcounter{propertyname}{0}

\begin{property} \label{property: density-1}
    $f(x,y) \geqslant 0$
\end{property}

\begin{property} \label{property: density-2}
    $\displaystyle\int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} f(x,y) \, \text{d}x \text{d}y = 1$
\end{property}

\begin{property}
    如果 $f(x,y)$ 在点 $(x,y)$ 处连续，则
    $$
    f(x,y) = \dfrac{\partial^2 F(x,y)}{\partial x \partial y}
    $$
\end{property}

\begin{property} \label{property: density-4}
    设 $G$ 是 $xOy$ 平面上的一个区域，则
    $$
    P\{(X,Y) \in G\} = \underset{G}{\iint} f(x,y) \, \text{d}x \text{d}y
    $$
\end{property}

$z=f(x,y)$ 表示空间 $Oxyz$ 中的一张曲面. 性质 \ref*{property: density-1} 和性质 \ref*{property: density-2} 表明，曲面 $z=f(x,y)$ 位于 $xOy$ 平面上方，介于它和 $xOy$ 平面之间的体积为 1. 性质 \ref*{property: density-4} 表示，随机点 $(X,Y)$ 落在区域 $G$ 内的概率 $P\{(X,Y) \in G\}$ 等于以 $G$ 为底、以曲面 $z=f(x,y)$ 为顶的曲顶柱体体积的数值.

\subsection{边缘概率密度}

\begin{definition}
    设二维连续型随机变量 $(X,Y)$ 的概率密度为 $f(x,y), (x,y) \in \mathbf{R}^2$，将一元函数
    \begin{gather*}
        f_{X}(x) = \int_{-\infty}^{+\infty} f(x,y) \, \text{d}y, \ x \in \mathbf{R} \\
        f_{Y}(y) = \int_{-\infty}^{+\infty} f(x,y) \, \text{d}x, \ y \in \mathbf{R}
    \end{gather*}
    分别称为二维随机变量 $(X,Y)$ 关于 $X$ 和关于 $Y$ 的\textbf{边缘概率密度}.
\end{definition}

\subsection{随机变量的独立性}

设二维连续型随机变量 $(X,Y)$ 的概率密度为 $f(x,y), (x,y) \in \mathbf{R}^2$，$(X,Y)$ 关于 $X$ 和关于 $Y$ 的边缘概率密度分别为 $f_{X}(x)$ 和 $f_{Y}(y)$，则随机变量 $X$ 和 $Y$ 相互独立的充分必要条件是：对任意 $x,y \in \mathbf{R}$，都有 $f(x,y)=f_{X}(x) \, f_{Y}(y)$.

\subsection{二维均匀分布}

设 $D$ 是 $xOy$ 平面上的有界区域，其面积为 $A$. 如果二维随机变量 $(X,Y)$ 具有概率密度
$$
f(x,y)=\begin{cases}
    \dfrac{1}{A} & (x,y) \in D \\[0.5em]
    0 & 其他
\end{cases}
$$
则称 $(X,Y)$ 在区域 $D$ 上服从\textbf{均匀分布}.

\subsection{二维正态分布}

设二维随机变量 $(X,Y)$ 的概率密度为
$$
f(x,y) = \dfrac{1}{2 \pi \sigma_1 \sigma_2 \sqrt{1-\rho^2}} e^{\frac{-1}{2(1-\rho^2)} \left[ \frac{(x-\mu_1)^2}{\sigma_1^2} - 2 \rho \frac{(x-\mu_1)(y-\mu_2)}{\sigma_1 \sigma_2} + \frac{(y-\mu_2)^2}{\sigma_2^2} \right]},\ (x,y)\in \mathbf{R}^2
$$
其中 $\mu_1,\mu_2,\sigma_1,\sigma_2,\rho$ 都是常数，且 $\sigma_1 > 0, \sigma_2 > 0, -1 < \rho < 1$，则称 $(X,Y)$ 服从参数为 $\mu_1,\mu_2,\sigma_1,\sigma_2,\rho$ 的\textbf{二维正态分布}，记作 $(X,Y) \sim N(\mu_1,\mu_2,\sigma_1^2,\sigma_2^2,\rho)$.

\begin{conclusion}
    设 $(X,Y) \sim N(\mu_1,\mu_2,\sigma_1^2,\sigma_2^2,\rho)$，则 $(X,Y)$ 关于 $X$ 和关于 $Y$ 的边缘概率密度分别为
    \begin{gather*}
        f_{X}(x) = \dfrac{1}{\sqrt{2\pi} \sigma_1} e^{-\frac{(x-\mu_1)^2}{2 \sigma_1^2}}, -\infty < x < +\infty \\
        f_{Y}(y) = \dfrac{1}{\sqrt{2\pi} \sigma_2} e^{-\frac{(y-\mu_2)^2}{2 \sigma_2^2}}, -\infty < y < +\infty
    \end{gather*}
\end{conclusion}

\begin{myproof}
    $$
    \begin{aligned}
        & \frac{-1}{2(1-\rho^2)} \left[ \frac{(x-\mu_1)^2}{\sigma_1^2} - 2 \rho \frac{(x-\mu_1)(y-\mu_2)}{\sigma_1 \sigma_2} + \frac{(y-\mu_2)^2}{\sigma_2^2} \right] \\
        = & \frac{-1}{2(1-\rho^2)} \left\{ \frac{(x-\mu_1)^2}{\sigma_1^2} + \left[ \frac{(y-\mu_2)^2}{\sigma_2^2} - 2 \rho \frac{(x-\mu_1)(y-\mu_2)}{\sigma_1 \sigma_2} + \rho^2 \frac{(x-\mu_1)^2}{\sigma_1^2} \right] - \rho^2 \frac{(x-\mu_1)^2}{\sigma_1^2} \right\} \\
        = & \frac{-1}{2(1-\rho^2)} \left\{ \frac{(1-\rho^2)(x-\mu_1)^2}{\sigma_1^2} + \left( \dfrac{y-\mu_2}{\sigma_2} - \rho \dfrac{x-\mu_1}{\sigma_1} \right)^2 \right\} \\
        = & -\frac{(x-\mu_1)^2}{2\sigma_1^2} - \dfrac{1}{2(1-\rho^2)} \left( \dfrac{y-\mu_2}{\sigma_2} - \rho \dfrac{x-\mu_1}{\sigma_1} \right)^2
    \end{aligned}
    $$
    因此
    $$
    \begin{aligned}
        f_{X}(x) &= \int_{-\infty}^{+\infty} f(x,y) \, \text{d}y \\
        &= \dfrac{1}{2 \pi \sigma_1 \sigma_2 \sqrt{1-\rho^2}} e^{-\frac{(x-\mu_1)^2}{2 \sigma_1^2}} \int_{-\infty}^{+\infty} e^{\frac{-1}{2(1-\rho^2)} \left( \frac{y-\mu_2}{\sigma_2} - \rho \frac{x-\mu_1}{\sigma_1} \right)^2} \, \text{d}y
    \end{aligned}
    $$
    对于任意给定的实数 $x$，令 $t = \dfrac{1}{\sqrt{1-\rho^2}} \left( \dfrac{y-\mu_2}{\sigma_2} - \rho \dfrac{x-\mu_1}{\sigma_1} \right)$，则
    $$
    \text{d}t = \dfrac{1}{\sigma_2 \sqrt{1-\rho^2}} \text{d}y
    $$
    因此
    $$
    \begin{aligned}
        f_{X}(x) &= \dfrac{1}{2 \pi \sigma_1} e^{-\frac{(x-\mu_1)^2}{2 \sigma_1^2}} \int_{-\infty}^{+\infty} e^{-\frac{t^2}{2}} \dfrac{1}{\sigma_2 \sqrt{1-\rho^2}} \text{d}y \\
        &= \dfrac{1}{\sqrt{2\pi} \sigma_1} e^{-\frac{(x-\mu_1)^2}{2 \sigma_1^2}} \int_{-\infty}^{+\infty} \dfrac{1}{\sqrt{2\pi}} e^{-\frac{t^2}{2}} \, \text{d}t
    \end{aligned}
    $$
    因为
    $$
    \int_{-\infty}^{+\infty} \dfrac{1}{\sqrt{2\pi}} e^{-\frac{t^2}{2}} \, \text{d}t = 1
    $$
    所以
    $$
    f_{X}(x) = \dfrac{1}{\sqrt{2\pi} \sigma_1} e^{-\frac{(x-\mu_1)^2}{2 \sigma_1^2}}
    $$

    同理可得
    $$
    f_{Y}(y) = \dfrac{1}{\sqrt{2\pi} \sigma_2} e^{-\frac{(y-\mu_2)^2}{2 \sigma_2^2}}
    $$
\end{myproof}

由此可知，若 $(X,Y) \sim N(\mu_1,\mu_2,\sigma_1^2,\sigma_2^2,\rho)$，则 $(X,Y)$ 关于 $X$ 和关于 $Y$ 的边缘分布都是一维正态分布，且有 $X \sim N(\mu_1,\sigma_1^2)$，$Y \sim N(\mu_2,\sigma_2^2)$. $(X,Y)$ 的分布与参数 $\rho$ 有关，对于不同的 $\rho$，有不同的二维正态分布，但 $(X,Y)$ 关于 $X$ 和关于 $Y$ 的边缘分布都与 $\rho$ 无关.

上述结论还表明，仅仅根据关于 $X$ 和关于 $Y$ 的边缘分布，一般是不能确定随机变量 $X$ 和 $Y$ 的联合分布的.

\begin{conclusion}
    设 $(X,Y) \sim N(\mu_1,\mu_2,\sigma_1^2,\sigma_2^2,\rho)$，则 $X$ 与 $Y$ 相互独立的充分必要条件是 $\rho=0$.
\end{conclusion}

\begin{myproof}
    $$
    f_{X}(x) \, f_{Y}(y) = \dfrac{1}{2 \pi \sigma_1 \sigma_2} e^{-\frac{1}{2} \left[ \frac{(x-\mu_1)^2}{2 \sigma_1^2} + \frac{(y-\mu_2)^2}{2 \sigma_2^2} \right]}
    $$

    先证充分性. 如果 $\rho=0$，则对于任意实数 $x$ 和 $y$，都有 $f(x,y) = f_{X}(x) \, f_{Y}(y)$，因此 $X$ 和 $Y$ 相互独立. 充分性得证.

    再证必要性. 如果 $X$ 和 $Y$ 相互独立，由于 $f(x,y), f_{X}(x), f_{Y}(y)$ 都是连续函数，因此对于任意实数 $x$ 和 $y$，都有 $f(x,y) = f_{X}(x) \, f_{Y}(y)$. 如果取 $x=\mu_1, y=\mu_2$，则有
    $$
    \begin{cases}
        f(\mu_1,\mu_2) = \dfrac{1}{2 \pi \sigma_1 \sigma_2 \sqrt{1-\rho^2}} \\[0.5em]
        f_{X}(\mu_1) \, f_{Y}(\mu_2) = \dfrac{1}{2 \pi \sigma_1 \sigma_2} \\[0.5em]
        f(\mu_1,\mu_2) = f_{X}(\mu_1) \, f_{Y}(\mu_2)
    \end{cases}
    $$
    从而 $\rho=0$. 必要性得证.
\end{myproof}

\section{条件分布}

\subsection{离散型随机变量的条件分布}

\begin{definition}
    设 $(X,Y)$ 是二维离散型随机变量，对于固定的 $j$，如果 $P\{Y = y_j\} = p_{\cdot j} > 0$，则称
    $$
    P\{X=x_i | Y=y_j\} = \dfrac{P\{X=x_i, Y=y_j\}}{P\{Y=y_j\}} = \dfrac{p_{ij}}{p_{\cdot j}},\ i=1,2,\cdots
    $$
    为在条件 $Y=y_j$ 下随机变量 $X$ 的\textbf{条件概率分布}.
    
    对于固定的 $i$，如果 $P\{X=x_i\} = p_{i \cdot} > 0$，则称
    $$
    P\{Y=y_j | X=x_i\} = \dfrac{P\{X=x_i,Y=y_j\}}{P\{X=x_i\}} = \dfrac{p_{ij}}{p_{i \cdot}},\ j=1,2,\cdots
    $$
    为在条件 $X=x_i$ 下随机变量 $Y$ 的\textbf{条件概率分布}.
\end{definition}

\subsection{连续型随机变量的条件分布}

\begin{definition}
    设 $(X,Y)$ 是二维连续型随机变量，对于给定的实数 $y$ 及任意给定的正数 $\varepsilon$，都有 $P\{y-\varepsilon < Y \leqslant y+\varepsilon\} > 0$. 如果对于任意实数 $x$，极限
    $$
    \lim_{\varepsilon \to 0^+} P\{X \leqslant x \;|\; y-\varepsilon < Y \leqslant y+\varepsilon\} = \lim_{\varepsilon \to 0^+} \dfrac{P\{X \leqslant x, y-\varepsilon < Y \leqslant y+\varepsilon\}}{P\{y-\varepsilon < Y \leqslant y+\varepsilon\}}
    $$
    存在，则称此极限值为在条件 $Y=y$ 下 $X$ 的\textbf{条件分布函数}，记作 $F_{X|Y}(x|y)$. 如果非负函数 $f_{X|Y}(x|y)$ 使得
    $$
    F_{X|Y}(x|y) = \int_{-\infty}^x f_{X|Y}(u|y) \, \text{d}u,\ x \in \mathbf{R}
    $$
    成立，则称 $f_{X|Y}(x|y)$ 为在条件 $Y=y$ 下 $X$ 的\textbf{条件概率密度}.
\end{definition}

设二维连续型随机变量 $(X,Y)$ 的分布函数为 $F(x,y)$，概率密度为 $f(x,y)$. 如果在点 $(x,y)$ 处 $f(x,y)$ 连续，$(X,Y)$ 关于 $Y$ 的边缘概率密度 $f_{Y}(y)$ 连续，且 $f_{Y}(y)>0$，$Y$ 的分布函数为 $F_{Y}(y)$，则有
$$
\begin{aligned}
    F_{X|Y}(x|y) &= \lim_{\varepsilon \to 0^+} \dfrac{P\{X \leqslant x, y-\varepsilon < Y \leqslant y+\varepsilon\}}{P\{y-\varepsilon < Y \leqslant y+\varepsilon\}} \\[0.7em]
    &= \lim_{\varepsilon \to 0^+} \dfrac{F(x, y+\varepsilon) - F(x, y-\varepsilon)}{F_{Y}(y+\varepsilon) - F_{Y}(y-\varepsilon)} \\[0.7em]
    &= \lim_{\varepsilon \to 0^+} \dfrac{\dfrac{F(x, y+\varepsilon) - F(x,y)}{\varepsilon} + \dfrac{F(x, y-\varepsilon) - F(x,y)}{-\varepsilon}}{\dfrac{F_{Y}(y+\varepsilon) - F_{Y}(y)}{\varepsilon} + \dfrac{F_{Y}(y-\varepsilon) - F_{Y}(y)}{-\varepsilon}} \\
    &= \dfrac{\dfrac{\partial F(x,y)}{\partial y}}{\dfrac{\text{d} F_{Y}(y)}{\text{d}y}} \\[1em]
    &= \dfrac{\displaystyle\int_{-\infty}^x f(u,y) \, \text{d}u}{f_{Y}(y)} \\[1em]
    &= \int_{-\infty}^x \dfrac{f(u,y)}{f_{Y}(y)} \text{d}u
\end{aligned}
$$
由此可得在条件 $Y=y$ 下 $X$ 的条件概率密度为
$$
f_{X|Y}(x|y) = \dfrac{f(x,y)}{f_{Y}(y)},\ x \in \mathbf{R}
$$

类似地，可以定义在条件 $X=x$ 下 $Y$ 的条件分布函数 $F_{Y|X}(y|x)$ 和在条件 $X=x$ 下 $Y$ 的条件概率密度 $f_{Y|X}(y|x)=\dfrac{f(x,y)}{f_{X}(x)},\ y \in \mathbf{R}$.

\section{二维随机变量的函数的分布}

设 $(X,Y)$ 为二维随机变量，$g(x,y)$ 为二元函数，则一维随机变量 $Z=g(X,Y)$ 是二维随机变量 $(X,Y)$ 的函数.

\subsection{二维离散型随机变量的函数的分布}

\begin{problem}
    设 $(X,Y)$ 的概率分布为
    \begin{table}[H]
        \centering
    
        \begin{tabular}{c | c c c c}
            \hline
            \diagbox{$X$}{$Y$} & -1 & 1 & 2 \\
            \hline
            \rule{0pt}{20pt}0 & $\dfrac{1}{10}$ & $\dfrac{2}{10}$ & $\dfrac{1}{10}$ \\[4pt]
            \rule{0pt}{20pt}2 & $\dfrac{3}{10}$ & $\dfrac{1}{10}$ & $\dfrac{2}{10}$ \\[4pt]
            \hline
        \end{tabular}
    \end{table}
    求 $X+Y$ 的概率分布.
\end{problem}

\begin{solution}
    $X+Y$ 所有可能取的值为 $-1,1,2,3,4$，且
    $$
    \begin{aligned}
        & P\{X+Y=-1\} = P\{X=0,Y=-1\} = \dfrac{1}{10} \\[0.5em]
        & P\{X+Y=1\} = P\{X=0,Y=1\} + P\{X=2,Y=-1\} = \dfrac{2}{10} + \dfrac{3}{10} = \dfrac{1}{2} \\[0.5em]
        & P\{X+Y=2\} = P\{X=0,Y=2\} = \dfrac{1}{10} \\[0.5em]
        & P\{X+Y=3\} = P\{X=2,Y=1\} = \dfrac{1}{10} \\[0.5em]
        & P\{X+Y=4\} = P\{X=2,Y=2\} = \dfrac{2}{10} = \dfrac{1}{5}
    \end{aligned}
    $$
    即 $X+Y$ 的概率分布为

    \begin{table}[H]
        \centering
    
        \begin{tabular}{c | c c c c c}
            \hline
            $X+Y$ & -1 & 1 & 2 & 3 & 4 \\
            \hline
            \rule{0pt}{20pt}$P$ & $\dfrac{1}{10}$ & $\dfrac{1}{2}$ & $\dfrac{1}{10}$ & $\dfrac{1}{10}$ & $\dfrac{1}{5}$ \\[4pt]
            \hline
        \end{tabular}
    \end{table}
\end{solution}

\begin{conclusion}
    设随机变量 $X$ 和 $Y$ 相互独立，且 $X \sim P(\lambda_1)$，$Y \sim P(\lambda_2)$，则 $X+Y \sim P(\lambda_1 + \lambda_2)$.
\end{conclusion}

\begin{myproof}
    因为 $X \sim P(\lambda_1)$，$Y \sim P(\lambda_2)$，所以
    \begin{gather*}
        P\{X=i\} = \dfrac{\lambda_1^i e^{-\lambda_1}}{i!},\ i=0,1,2,\cdots \\[0.5em]
        P\{Y=j\} = \dfrac{\lambda_2^j e^{-\lambda_2}}{j!},\ j=0,1,2,\cdots
    \end{gather*}

    $X+Y$ 所有可能取的值为 $0,1,2,\cdots$. 由于 $X$ 和 $Y$ 相互独立，因此对于任意的非负整数 $k$，有
    $$
    \begin{aligned}
        P\{X+Y=k\} &= P(\bigcup_{l=0}^k \{X=l, Y=k-l\}) \\
        &= \sum_{l=0}^k (P\{X=l\} \cdot P\{Y=k-l\}) \\
        &= \sum_{l=0}^k \left[ \dfrac{\lambda_1^l e^{-\lambda_1}}{l!} \dfrac{\lambda_2^{k-l} e^{-\lambda_2}}{(k-l)!} \right] \\
        &= \sum_{l=0}^k \left[ \dfrac{k!}{l!(k-l)!} \lambda_1^l \lambda_2^{k-l} \dfrac{e^{-(\lambda_1 + \lambda_2)}}{k!} \right] \\
        &= \dfrac{e^{-(\lambda_1 + \lambda_2)}}{k!} \sum_{i=0}^k \dfrac{k!}{l!(k-l)!} \lambda_1^l \lambda_2^{k-l} \\
        &= \dfrac{(\lambda_1 + \lambda_2)^k e^{-(\lambda_1 + \lambda_2)}}{k!}
    \end{aligned}
    $$
    即 $X+Y \sim P(\lambda_1 + \lambda_2)$.
\end{myproof}

\subsection{二维连续型随机变量的函数的分布}

设 $(X,Y)$ 为二维连续型随机变量，其概率密度为 $f(x,y)$.

\subsubsection{$Z=X+Y$ 的概率密度}

首先求 $Z$ 的分布函数

$$
\begin{aligned}
    F_{Z}(z) &= P\{Z \leqslant z\} = P\{X+Y \leqslant z\} \\
    &= \underset{x+y \leqslant z}{\iint} f(x,y) \, \text{d}x \text{d}y \\
    &= \int_{-\infty}^{+\infty} \int_{-\infty}^{z-x} f(x,y) \, \text{d}y \text{d}x \\
\end{aligned}
$$

对固定的 $z$ 和 $x$，作变量代换 $y=u-x$，得
$$
\int_{-\infty}^{z-x} f(x,y) \, \text{d}y = \int_{-\infty}^z f(x,u-x) \, \text{d}u
$$
因此
$$
\begin{aligned}
    F_{Z}(z) &= \int_{-\infty}^{+\infty} \int_{-\infty}^z f(x,u-x) \, \text{d}u \text{d}x \\
    &= \int_{-\infty}^z \int_{-\infty}^{+\infty} f(x,u-x) \, \text{d}x \text{d}u 
\end{aligned}
$$
于是，随机变量 $Z$ 的概率密度为
$$
f_{Z}(z) = \int_{-\infty}^{+\infty} f(x,z-x) \, \text{d}x
$$

同理可得
$$
f_{Z}(z) = \int_{-\infty}^{+\infty} f(z-y,y) \, \text{d}y
$$

如果 $X$ 和 $Y$ 相互独立，设 $f_{X}(x)$ 和 $f_{Y}(y)$ 分别是二维随机变量 $(X,Y)$ 关于 $X$ 和关于 $Y$ 的边缘概率密度，则有
\begin{gather*}
    f_{Z}(z) = \int_{-\infty}^{+\infty} f_{X}(x) f_{Y}(z-x) \, \text{d}x \\
    f_{Z}(z) = \int_{-\infty}^{+\infty} f_{X}(z-y) f_{Y}(y) \, \text{d}y
\end{gather*}
上式称为 $f_X$ 和 $f_Y$ 的\textbf{卷积公式}，记作 $f_X * f_Y$，即
\begin{equation}
    f_{Z}(z) = f_X * f_Y = \int_{-\infty}^{+\infty} f_{X}(x) f_{Y}(z-x) \, \text{d}x = \int_{-\infty}^{+\infty} f_{X}(z-y) f_{Y}(y) \, \text{d}y
\end{equation}

如果随机变量 $X$ 和 $Y$ 相互独立，并且 $X \sim N(\mu_1,\sigma_1^2)$，$Y \sim N(\mu_2,\sigma_2^2)$，则利用卷积公式可求得随机变量 $Z=X+Y$ 的概率密度，从而可知 $Z=X+Y$ 仍服从正态分布，且
$$
Z = X+Y \sim N(\mu_1 + \mu_2, \sigma_1^2 + \sigma_2^2)
$$

\subsubsection{$M = \max(X,Y)$ 及 $N = \min(X,Y)$ 的分布函数}

设随机变量 $X$ 和 $Y$ 相互独立，分布函数分别为 $F_{X}(x)$ 和 $F_{Y}(y)$，$M = \max(X,Y)$ 和 $N = \min(X,Y)$ 的分布函数分别为 $F_{\text{max}}(z)$ 和 $F_{\text{min}}(z)$.

由于事件 $\{M \leqslant z\} = \{X \leqslant z, Y \leqslant z\}$，而 $X$ 和 $Y$ 相互独立，所以事件 $\{X \leqslant z\}$ 与事件 $\{Y \leqslant z\}$ 相互独立，由此可得
$$
\begin{aligned}
    F_{\text{max}}(z) &= P\{M \leqslant z\} \\
    &= P\{X \leqslant z, Y \leqslant z\} \\
    &= P\{X \leqslant z\} \, P\{Y \leqslant z\} \\
    &= F_{X}(z) \, F_{Y}(z)
\end{aligned}
$$

由于事件 $\{N>z\} = \{X>z, Y>z\}$，而 $X$ 和 $Y$ 相互独立，所以事件 $\{X>z\}$ 与事件 $\{Y>z\}$ 相互独立，由此可得
$$
\begin{aligned}
    F_{\text{min}}(z) &= P\{N \leqslant z\} \\
    &= 1 - P\{N>z\} \\
    &= 1 - P\{X>z, Y>z\} \\
    &= 1 - P\{X>z\} \, P\{Y>z\} \\
    &= 1 - (1 - P\{X \leqslant z\})(1 - P\{Y \leqslant z\}) \\
    &= 1 - [1 - F_{X}(z)][1 - F_{Y}(z)]
\end{aligned}
$$

\subsubsection{瑞利分布}

设随机变量 $X$ 和 $Y$ 相互独立，并且都服从正态分布 $N(0, \sigma^2)$，则随机变量 $Z = \sqrt{X^2 + Y^2}$ 服从参数为 $\sigma \; (\sigma > 0)$ 的\textbf{瑞利分布}（Rayleigh distribution）.

由于随机变量 $X$ 和 $Y$ 相互独立，因此二维随机变量 $(X,Y)$ 的概率密度为
$$
f(x,y) = f_{X}(x) \, f_{Y}(y) = \dfrac{1}{2 \pi \sigma^2} e^{-\frac{x^2 + y^2}{2 \sigma^2}}
$$

当 $z<0$ 时，有
$$
F_{Z}(z) = P\{Z \leqslant z\} = P\{\sqrt{X^2 + Y^2} \leqslant z\} = 0
$$

当 $z \geqslant 0$ 时，有
$$
\begin{aligned}
    F_{Z}(z) &= P\{Z \leqslant z\} = P\{\sqrt{X^2 + Y^2} \leqslant z\} \\
    &= \underset{\sqrt{X^2 + Y^2} \leqslant z}{\iint} f(x,y) \, \text{d}x \text{d}y \\
    &= \underset{\sqrt{X^2 + Y^2} \leqslant z}{\iint} \dfrac{1}{2 \pi \sigma^2} e^{-\frac{x^2 + y^2}{2 \sigma^2}} \, \text{d}x \text{d}y \\
    &= \dfrac{1}{2 \pi} \int_0^{2 \pi} \text{d}\theta \int_0^z \dfrac{1}{\sigma^2} e^{-\frac{r^2}{2 \sigma^2}} r \, \text{d}r \\
    &= \left. -e^{-\frac{r^2}{2 \sigma^2}} \right|_0^z \\
    &= 1 - e^{-\frac{z^2}{2 \sigma^2}}
\end{aligned}
$$